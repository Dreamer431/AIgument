<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIgument</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        /* 基础Markdown样式 */
        .markdown-content {
            line-height: 1.6;
        }
        .markdown-content h1, .markdown-content h2, .markdown-content h3,
        .markdown-content h4, .markdown-content h5, .markdown-content h6 {
            margin-top: 1.2em;
            margin-bottom: 0.8em;
            font-weight: 600;
        }
        .markdown-content h1 { font-size: 1.8em; }
        .markdown-content h2 { font-size: 1.5em; }
        .markdown-content h3 { font-size: 1.3em; }
        .markdown-content h4 { font-size: 1.1em; }
        .markdown-content p { margin-bottom: 1em; }
        .markdown-content ul, .markdown-content ol {
            margin-bottom: 1em;
            padding-left: 1.5em;
        }
        .markdown-content ul { list-style-type: disc; }
        .markdown-content ol { list-style-type: decimal; }
        .markdown-content blockquote {
            border-left: 3px solid #cbd5e0;
            padding-left: 1em;
            margin-bottom: 1em;
            color: #4a5568;
        }
        .markdown-content code {
            background-color: #f7fafc;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: monospace;
        }
        .markdown-content pre {
            background-color: #f7fafc;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 1em;
        }
        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
        }
        .markdown-content table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1em;
        }
        .markdown-content th, .markdown-content td {
            border: 1px solid #e2e8f0;
            padding: 0.5em;
        }
        .markdown-content th {
            background-color: #f7fafc;
        }

        /* 添加平滑动画和现代UI样式 */
        body {
            background: linear-gradient(135deg, #EBF4F5 0%, #D2E9F5 100%);
            min-height: 100vh;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }
        
        .btn-primary {
            background: linear-gradient(to right, #56CCF2, #3498db);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(86, 204, 242, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(86, 204, 242, 0.5);
        }
        
        /* 打字机效果 */
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        .typing-effect {
            overflow: hidden;
            border-right: .15em solid transparent;
            white-space: normal;
            letter-spacing: normal;
            animation: blink-caret .75s step-end infinite;
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: #56CCF2 }
        }
        
        /* 闪烁动画 */
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .pulse {
            animation: fadeInOut 2s infinite;
        }
        
        /* 渐变背景动画 */
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-animation {
            background: linear-gradient(270deg, #56CCF2, #2E86DE, #56CCF2);
            background-size: 200% 200%;
            animation: gradientAnimation 5s ease infinite;
            -webkit-background-clip: text;
            background-clip: text;
        }
        
        .title-gradient {
            background: linear-gradient(to right, #3498db, #56CCF2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: inline-block;
            padding: 0.2em 0;
            text-shadow: 0 0 1px rgba(0,0,0,0.05);
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #56CCF2;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #3498db;
        }
        
        /* 响应式调整 */
        @media (max-width: 640px) {
            .container {
                padding: 10px;
            }
        }
        
        /* 模式选择样式 */
        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 0.5rem;
        }
        
        .mode-option {
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            background-color: #f0f4f8;
            color: #4a5568;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .mode-option:hover {
            background-color: #e2e8f0;
        }
        
        .mode-option.active {
            background-color: #ebf8ff;
            color: #3498db;
            border-color: #56CCF2;
        }
        
        /* 响应式调整 */
        @media (max-width: 640px) {
            .container {
                padding: 10px;
            }
            
            .mode-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-option {
                width: 100%;
                text-align: center;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center animate__animated animate__fadeIn">
            <h1 class="text-5xl font-bold mb-4 title-gradient">AIgument</h1>
            <p class="text-gray-600 mb-8 text-lg mt-5">人工智能交互平台</p>
        </div>
        
        <div class="max-w-4xl mx-auto card p-6 animate__animated animate__fadeInUp">
            <!-- 模式选择器 -->
            <div class="mode-selector mb-6">
                <div class="mode-option active" data-mode="debate">辩论模式</div>
                <div class="mode-option" data-mode="chat">AI对话模式</div>
                <div class="mode-option" data-mode="qa">问答模式</div>
            </div>
            
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2" id="topic-label">辩论主题</label>
                <input type="text" id="topic" 
                       class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"
                       placeholder="请输入辩论主题">
            </div>

            <!-- 辩论模式特有设置 -->
            <div id="debate-settings">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">辩论轮数</label>
                    <select id="rounds" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all appearance-none">
                        <option value="1">1轮</option>
                        <option value="2">2轮</option>
                        <option value="3" selected>3轮</option>
                        <option value="4">4轮</option>
                        <option value="5">5轮</option>
                    </select>
                </div>
            </div>
            
            <!-- 交流模式特有设置 -->
            <div id="chat-settings" class="hidden">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">第一个AI角色</label>
                    <select id="chat-role-1" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all appearance-none">
                        <option value="friend">朋友</option>
                        <option value="expert">专家</option>
                        <option value="teacher">老师</option>
                        <option value="student">学生</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">第二个AI角色</label>
                    <select id="chat-role-2" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all appearance-none">
                        <option value="friend">朋友</option>
                        <option value="expert" selected>专家</option>
                        <option value="teacher">老师</option>
                        <option value="student">学生</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">对话轮数</label>
                    <select id="chat-rounds" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all appearance-none">
                        <option value="1">1轮</option>
                        <option value="2">2轮</option>
                        <option value="3" selected>3轮</option>
                        <option value="4">4轮</option>
                        <option value="5">5轮</option>
                    </select>
                </div>
            </div>
            
            <!-- 问答模式特有设置 -->
            <div id="qa-settings" class="hidden">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">问答风格</label>
                    <select id="qa-style" class="w-full px-4 py-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all appearance-none">
                        <option value="detailed">详细解答</option>
                        <option value="concise">简洁回答</option>
                        <option value="socratic">苏格拉底式问答</option>
                    </select>
                </div>
            </div>
            
            <div class="mb-6">
                <label class="flex items-center space-x-3 cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="stream-mode" class="sr-only" checked>
                        <div class="w-10 h-4 bg-gray-300 rounded-full shadow-inner"></div>
                        <div class="dot absolute w-6 h-6 bg-white rounded-full shadow -left-1 -top-1 transition"></div>
                    </div>
                    <span class="text-gray-700">使用流式输出（实时显示回复）</span>
                </label>
            </div>
            
            <button onclick="startInteraction()" 
                    class="w-full btn-primary py-3 rounded-lg transition-all mb-6">
                <span class="inline-block" id="start-button-text">开始辩论</span>
            </button>

            <div id="loading" class="hidden text-center mb-6 animate__animated animate__fadeIn">
                <div class="flex justify-center items-center space-x-2 mt-4">
                    <div class="w-3 h-3 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.1s; animation-duration: 1.2s;"></div>
                    <div class="w-3 h-3 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s; animation-duration: 1.2s;"></div>
                    <div class="w-3 h-3 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0.3s; animation-duration: 1.2s;"></div>
                </div>
                <p class="mt-4 text-gray-600" id="loading-text">AI辩手正在激烈讨论中...</p>
            </div>

            <div id="results" class="space-y-6 hidden animate__animated animate__fadeIn">
                <div id="debate-history" class="space-y-4"></div>
            </div>
            
            <!-- 交流和问答模式的输入框 -->
            <div id="chat-input-container" class="hidden mt-6 animate__animated animate__fadeIn">
                <div class="flex">
                    <input type="text" id="chat-input" 
                           class="flex-grow px-4 py-3 rounded-l-lg border focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"
                           placeholder="输入您的消息...">
                    <button onclick="sendMessage()" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-6 rounded-r-lg transition-all">
                        发送
                    </button>
                </div>
            </div>

            <div id="error" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded animate__animated animate__shakeX"></div>
        </div>
    </div>

    <script>
        // Markdown设置
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: true,
            mangle: false,
            sanitize: false,
            smartLists: true,
            smartypants: true,
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (e) {}
                }
                return hljs.highlightAuto(code).value;
            }
        });

        // 切换开关样式
        document.getElementById('stream-mode').addEventListener('change', function() {
            const dot = this.parentElement.querySelector('.dot');
            if(this.checked) {
                dot.classList.add('transform', 'translate-x-6', 'bg-blue-400');
            } else {
                dot.classList.remove('transform', 'translate-x-6', 'bg-blue-400');
            }
        });

        // 初始化切换开关状态
        (function() {
            const checkbox = document.getElementById('stream-mode');
            const dot = checkbox.parentElement.querySelector('.dot');
            if(checkbox.checked) {
                dot.classList.add('transform', 'translate-x-6', 'bg-blue-400');
            } else {
                dot.classList.remove('transform', 'translate-x-6', 'bg-blue-400');
            }
        })();

        // 打字机效果函数
        function typeWriter(element, text, speed = 10, markdown = true) {
            let i = 0;
            let content = markdown ? marked.parse(text) : text;
            
            // 创建一个临时容器来解析HTML
            const temp = document.createElement('div');
            temp.innerHTML = content;
            
            // 清空目标元素内容
            element.innerHTML = '';
            element.classList.add('typing-effect');
            
            // 逐个添加解析后的子节点
            const children = Array.from(temp.childNodes);
            let currentIndex = 0;
            
            function addNextNode() {
                if (currentIndex < children.length) {
                    const node = children[currentIndex].cloneNode(true);
                    element.appendChild(node);
                    currentIndex++;
                    setTimeout(addNextNode, speed * 10);
                } else {
                    // 完成后应用代码高亮
                    element.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                    element.classList.remove('typing-effect');
                }
            }
            
            addNextNode();
        }

        // 模式选择功能
        const modeOptions = document.querySelectorAll('.mode-option');
        let currentMode = 'debate'; // 默认为辩论模式
        
        modeOptions.forEach(option => {
            option.addEventListener('click', function() {
                // 移除所有选项的active类
                modeOptions.forEach(opt => opt.classList.remove('active'));
                // 为当前选项添加active类
                this.classList.add('active');
                
                // 获取并设置当前模式
                currentMode = this.getAttribute('data-mode');
                
                // 更新UI显示
                updateUIForMode(currentMode);
            });
        });
        
        // 根据模式更新UI
        function updateUIForMode(mode) {
            // 隐藏所有模式特有设置
            document.getElementById('debate-settings').classList.add('hidden');
            document.getElementById('chat-settings').classList.add('hidden');
            document.getElementById('qa-settings').classList.add('hidden');
            document.getElementById('chat-input-container').classList.add('hidden');
            
            // 显示当前模式的设置
            if (mode === 'debate') {
                document.getElementById('debate-settings').classList.remove('hidden');
                document.getElementById('topic-label').textContent = '辩论主题';
                document.getElementById('topic').placeholder = '请输入辩论主题';
                document.getElementById('start-button-text').textContent = '开始辩论';
                document.getElementById('loading-text').textContent = 'AI辩手正在激烈讨论中...';
            } else if (mode === 'chat') {
                document.getElementById('chat-settings').classList.remove('hidden');
                document.getElementById('topic-label').textContent = '对话主题';
                document.getElementById('topic').placeholder = '请输入对话主题';
                document.getElementById('start-button-text').textContent = '开始AI对话';
                document.getElementById('loading-text').textContent = 'AI角色正在对话中...';
            } else if (mode === 'qa') {
                document.getElementById('qa-settings').classList.remove('hidden');
                document.getElementById('topic-label').textContent = '问题';
                document.getElementById('topic').placeholder = '请输入您的问题';
                document.getElementById('start-button-text').textContent = '提问';
                document.getElementById('loading-text').textContent = 'AI正在思考答案...';
            }
        }
        
        // 开始交互（统一入口函数）
        async function startInteraction() {
            const topic = document.getElementById('topic').value.trim();
            
            if (!topic) {
                showError(currentMode === 'debate' ? '请输入辩论主题' : 
                          currentMode === 'chat' ? '请输入对话主题' : '请输入您的问题');
                return;
            }
            
            // 显示加载状态和结果容器
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');
            
            // 清空之前的内容
            const historyContainer = document.getElementById('debate-history');
            historyContainer.innerHTML = '';
            
            try {
                if (currentMode === 'debate') {
                    // 辩论模式
                    const rounds = parseInt(document.getElementById('rounds').value);
                    const streamMode = document.getElementById('stream-mode').checked;
                    
                    // 显示主题
                    const topicElement = document.createElement('div');
                    topicElement.className = 'card p-4 animate__animated animate__fadeIn';
                    topicElement.innerHTML = `<h2 class="text-xl font-bold text-blue-600">辩论主题：${topic}</h2>`;
                    historyContainer.appendChild(topicElement);
                    
                    if (streamMode) {
                        await streamDebate(topic, rounds, historyContainer);
                    } else {
                        await regularDebate(topic, rounds, historyContainer);
                    }
                } else if (currentMode === 'chat') {
                    // AI对话模式
                    const role1 = document.getElementById('chat-role-1').value;
                    const role2 = document.getElementById('chat-role-2').value;
                    const chatRounds = parseInt(document.getElementById('chat-rounds').value);
                    const streamMode = document.getElementById('stream-mode').checked;
                    
                    // 显示主题
                    const topicElement = document.createElement('div');
                    topicElement.className = 'card p-4 animate__animated animate__fadeIn';
                    topicElement.innerHTML = `<h2 class="text-xl font-bold text-blue-600">对话主题：${topic}</h2>`;
                    historyContainer.appendChild(topicElement);
                    
                    // 开始AI对话
                    await aiConversation(topic, role1, role2, chatRounds, streamMode, historyContainer);
                } else if (currentMode === 'qa') {
                    // 问答模式
                    const style = document.getElementById('qa-style').value;
                    
                    // 显示问题
                    const questionElement = document.createElement('div');
                    questionElement.className = 'card p-4 animate__animated animate__fadeIn';
                    questionElement.innerHTML = `<h2 class="text-xl font-bold text-blue-600">问题：${topic}</h2>`;
                    historyContainer.appendChild(questionElement);
                    
                    // 获取答案
                    await getAnswer(topic, style, historyContainer);
                    
                    // 显示输入框用于追问
                    document.getElementById('chat-input-container').classList.remove('hidden');
                }
            } catch (error) {
                console.error('交互过程出错:', error);
                showError('请求失败，请稍后重试');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
        
        // 发送消息（用于交流和问答模式）
        async function sendMessage() {
            const messageInput = document.getElementById('chat-input');
            const message = messageInput.value.trim();
            
            if (!message) {
                return;
            }
            
            // 清空输入框
            messageInput.value = '';
            
            // 显示用户消息
            const historyContainer = document.getElementById('debate-history');
            const userMessageElement = document.createElement('div');
            userMessageElement.className = 'card p-4 mb-4 animate__animated animate__fadeIn';
            userMessageElement.innerHTML = `
                <h4 class="text-lg font-semibold mb-2 text-gray-700">您</h4>
                <div class="text-gray-700">${message}</div>
            `;
            historyContainer.appendChild(userMessageElement);
            
            // 显示加载状态
            document.getElementById('loading').classList.remove('hidden');
            
            try {
                // 根据当前模式处理消息
                if (currentMode === 'chat') {
                    await processChatMessage(message, historyContainer);
                } else if (currentMode === 'qa') {
                    const style = document.getElementById('qa-style').value;
                    await processFollowUpQuestion(message, style, historyContainer);
                }
            } catch (error) {
                console.error('消息处理出错:', error);
                showError('请求失败，请稍后重试');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }
        
        // 初始化交流（交流模式）
        async function initializeChat(topic, role, container) {
            // 这里应该调用后端API初始化交流
            // 由于后端API可能尚未实现，这里使用模拟数据
            
            // 模拟AI回应
            const aiResponseElement = document.createElement('div');
            aiResponseElement.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
            
            const contentElement = document.createElement('div');
            contentElement.className = 'text-gray-700 markdown-content';
            
            aiResponseElement.innerHTML = `
                <h4 class="text-lg font-semibold mb-2 text-blue-600">AI助手</h4>
            `;
            
            aiResponseElement.appendChild(contentElement);
            container.appendChild(aiResponseElement);
            
            // 使用打字机效果显示内容
            const roleMessages = {
                'friend': `嗨！很高兴能和你聊聊"${topic}"这个话题。作为朋友，我很想听听你的想法和感受。有什么特别想分享的吗？`,
                'expert': `您好！我很乐意就"${topic}"这个主题与您交流。作为这个领域的专家，我可以提供一些专业的见解和分析。您有什么具体想了解的方面吗？`,
                'teacher': `您好！很高兴能和您讨论"${topic}"这个主题。作为老师，我希望能帮助您更深入地理解这个话题。您有什么疑问或者想探讨的角度吗？`,
                'student': `您好！我对"${topic}"这个主题很感兴趣，希望能向您学习。作为学生，我有很多好奇和疑问，期待您的指导和分享。`
            };
            
            typeWriter(contentElement, roleMessages[role] || roleMessages['friend']);
            
            return new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        // 处理交流消息（交流模式）
        async function processChatMessage(message, container) {
            // 这里应该调用后端API处理交流消息
            // 由于后端API可能尚未实现，这里使用模拟数据
            
            // 模拟AI回应
            const aiResponseElement = document.createElement('div');
            aiResponseElement.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
            
            const contentElement = document.createElement('div');
            contentElement.className = 'text-gray-700 markdown-content';
            
            aiResponseElement.innerHTML = `
                <h4 class="text-lg font-semibold mb-2 text-blue-600">AI助手</h4>
            `;
            
            aiResponseElement.appendChild(contentElement);
            container.appendChild(aiResponseElement);
            
            // 使用打字机效果显示内容
            const response = `谢谢您的分享！这是一个很有趣的观点。我认为${message.length > 10 ? message.substring(0, 10) + '...' : message}确实值得深入探讨。

从不同角度来看：
1. 这个话题涉及到很多方面的考量
2. 每个人的经历和背景会影响对此的理解
3. 社会环境和时代背景也是重要因素

您对这些方面有什么特别的见解吗？我很期待继续听取您的想法。`;
            
            typeWriter(contentElement, response);
            
            return new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        // 获取答案（问答模式）
        async function getAnswer(question, style, container) {
            // 这里应该调用后端API获取答案
            // 由于后端API可能尚未实现，这里使用模拟数据
            
            // 模拟AI回应
            const aiResponseElement = document.createElement('div');
            aiResponseElement.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
            
            const contentElement = document.createElement('div');
            contentElement.className = 'text-gray-700 markdown-content';
            
            aiResponseElement.innerHTML = `
                <h4 class="text-lg font-semibold mb-2 text-blue-600">AI助手</h4>
            `;
            
            aiResponseElement.appendChild(contentElement);
            container.appendChild(aiResponseElement);
            
            // 根据不同风格生成不同回答
            let response = '';
            if (style === 'detailed') {
                response = `关于"${question}"，我可以提供一个详细的解答：

## 背景知识
这个问题涉及到多个领域的知识，包括...

## 核心概念
首先，我们需要理解几个关键概念：
1. 第一个重要概念...
2. 第二个重要概念...

## 分析
从多个角度分析这个问题：
- 从理论层面...
- 从实践角度...
- 从历史发展来看...

## 结论
综合以上分析，我们可以得出...

希望这个详细的解答对您有所帮助！如果您有任何后续问题，请随时提出。`;
            } else if (style === 'concise') {
                response = `关于"${question}"，简洁回答如下：

这个问题的核心在于...（关键点）。从主要证据来看，可以得出...（结论）。

需要注意的是...（重要提示）。`;
            } else if (style === 'socratic') {
                response = `关于"${question}"，我想请您思考以下几个问题：

1. 您认为这个问题的核心是什么？
2. 如果从不同角度看，会有什么不同的理解？
3. 这个问题的前提假设是否成立？

思考这些问题可能会帮助您找到更深层次的答案。您对第一个问题有什么想法？`;
            }
            
            typeWriter(contentElement, response);
            
            return new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        // 处理追问（问答模式）
        async function processFollowUpQuestion(question, style, container) {
            // 这里应该调用后端API处理追问
            // 由于后端API可能尚未实现，这里使用模拟数据
            
            // 模拟AI回应
            const aiResponseElement = document.createElement('div');
            aiResponseElement.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
            
            const contentElement = document.createElement('div');
            contentElement.className = 'text-gray-700 markdown-content';
            
            aiResponseElement.innerHTML = `
                <h4 class="text-lg font-semibold mb-2 text-blue-600">AI助手</h4>
            `;
            
            aiResponseElement.appendChild(contentElement);
            container.appendChild(aiResponseElement);
            
            // 使用打字机效果显示内容
            const response = `感谢您的追问！

关于"${question}"，我可以进一步解释：

这是一个很好的后续问题，它帮助我们更深入地探讨了主题的核心。从专业角度来看，这涉及到...

希望这个解答对您有帮助。您还有其他疑问吗？`;
            
            typeWriter(contentElement, response);
            
            return new Promise(resolve => setTimeout(resolve, 1000));
        }

        // 原有的辩论相关函数保持不变
        async function regularDebate(topic, rounds, historyContainer) {
            const response = await fetch('/api/debate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topic, rounds, stream: false })
            });

            const data = await response.json();

            if (response.ok) {
                renderDebateHistory(data.debate_history, historyContainer);
            } else {
                showError(data.error || '生成辩论内容时出错');
            }
        }

        async function streamDebate(topic, rounds, historyContainer) {
            // 初始化辩论
            const initResponse = await fetch('/api/debate/init', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ topic, rounds })
            });

            if (!initResponse.ok) {
                const error = await initResponse.json();
                throw new Error(error.message || '初始化辩论失败');
            }
            
            // 创建轮次容器
            let roundContainers = {};
            for (let i = 1; i <= rounds; i++) {
                const roundContainer = document.createElement('div');
                roundContainer.className = 'mb-6 animate__animated animate__fadeIn';
                roundContainer.style.animationDelay = `${(i-1)*0.3}s`;
                roundContainer.innerHTML = `<h3 class="text-lg font-semibold mb-3">第 ${i} 轮</h3>`;
                historyContainer.appendChild(roundContainer);
                roundContainers[i] = roundContainer;
            }
            
            // 为每轮每个辩论方创建内容容器
            let contentElements = {};
            for (let round = 1; round <= rounds; round++) {
                for (let side of ['正方', '反方']) {
                    const key = `${round}-${side}`;
                    const viewElement = document.createElement('div');
                    viewElement.className = `card p-6 mb-4 animate__animated animate__fadeIn`;
                    viewElement.style.animationDelay = `${(round-1)*0.3 + (side==='正方'?0.1:0.2)}s`;
                    
                    const sideClass = side === '正方' ? 'text-blue-600' : 'text-red-600';
                    viewElement.innerHTML = `
                        <h4 class="text-lg font-semibold mb-2 ${sideClass}">${side}观点</h4>
                        <div id="content-${key}" class="text-gray-700 markdown-content">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-${side === '正方' ? 'blue' : 'red'}-500 rounded-full pulse"></div>
                                <span>正在思考中...</span>
                            </div>
                        </div>
                    `;
                    roundContainers[round].appendChild(viewElement);
                    contentElements[key] = document.getElementById(`content-${key}`);
                }
            }
            
            // 开始流式接收辩论内容
            const eventSource = new EventSource(`/api/debate/stream?topic=${encodeURIComponent(topic)}&rounds=${rounds}`);
            
            eventSource.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'content') {
                    const key = `${data.round}-${data.side}`;
                    const contentElement = contentElements[key];
                    
                    // 使用打字机效果逐步显示内容
                    if (contentElement) {
                        // 如果是第一次更新内容，清除"正在思考中..."的提示
                        if (contentElement.querySelector('.pulse')) {
                            contentElement.innerHTML = '';
                        }
                        
                        // 使用打字机效果显示内容
                        contentElement.innerHTML = marked.parse(data.content);
                        
                        // 应用代码高亮
                        contentElement.querySelectorAll('pre code').forEach((block) => {
                            hljs.highlightElement(block);
                        });
                    }
                }
            };
            
            eventSource.onerror = (error) => {
                console.error('EventSource错误:', error);
                eventSource.close();
            };
            
            // 当辩论完成时关闭事件源
            eventSource.addEventListener('debate_complete', (event) => {
                eventSource.close();
            });
            
            return new Promise((resolve) => {
                eventSource.addEventListener('debate_complete', () => {
                    resolve();
                });
            });
        }

        function renderDebateHistory(debateHistory, container) {
            // 按轮次分组显示辩论内容
            let currentRound = 0;
            let roundContainer = null;
            
            debateHistory.forEach((entry, index) => {
                if (entry.round !== currentRound) {
                    currentRound = entry.round;
                    roundContainer = document.createElement('div');
                    roundContainer.className = 'mb-6 animate__animated animate__fadeIn';
                    roundContainer.style.animationDelay = `${(index)*0.1}s`;
                    roundContainer.innerHTML = `<h3 class="text-lg font-semibold mb-3">第 ${currentRound} 轮</h3>`;
                    container.appendChild(roundContainer);
                }

                const viewElement = document.createElement('div');
                viewElement.className = `card p-6 mb-4 animate__animated animate__fadeIn`;
                viewElement.style.animationDelay = `${(index+1)*0.1}s`;
                
                const contentElement = document.createElement('div');
                contentElement.className = 'text-gray-700 markdown-content';
                
                const sideClass = entry.side === '正方' ? 'text-blue-600' : 'text-red-600';
                
                viewElement.innerHTML = `
                    <h4 class="text-lg font-semibold mb-2 ${sideClass}">${entry.side}观点</h4>
                `;
                
                viewElement.appendChild(contentElement);
                roundContainer.appendChild(viewElement);
                
                // 使用打字机效果显示内容
                typeWriter(contentElement, entry.content);
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            // 添加动画类
            errorDiv.classList.add('animate__animated', 'animate__shakeX');
            
            // 移除动画类以便将来可以再次触发
            setTimeout(() => {
                errorDiv.classList.remove('animate__animated', 'animate__shakeX');
            }, 1000);
        }

        // 添加AI对话功能
        async function aiConversation(topic, role1, role2, rounds, streamMode, container) {
            // 这里应该调用后端API进行AI对话
            // 由于后端API可能尚未实现，这里使用模拟数据
            
            // 角色名称映射
            const roleNames = {
                'friend': '朋友',
                'expert': '专家',
                'teacher': '老师',
                'student': '学生'
            };
            
            // 角色颜色映射
            const roleColors = {
                'friend': 'text-green-600',
                'expert': 'text-purple-600',
                'teacher': 'text-blue-600',
                'student': 'text-orange-600'
            };
            
            // 模拟对话内容
            const conversations = [
                {
                    role1: `作为一名${roleNames[role1]}，我认为${topic}这个话题非常有意思。从我的角度来看，这涉及到几个关键方面：

首先，我们需要考虑**背景因素**和**历史发展**。这不仅仅是一个简单的问题，而是涉及到多层面的复杂议题。

其次，我想强调的是，在讨论这个话题时，我们应该保持开放的心态，尝试从不同角度理解问题。

您作为${roleNames[role2]}，对此有什么看法呢？`,
                    
                    role2: `感谢您的见解。作为一名${roleNames[role2]}，我想补充几点关于${topic}的专业观点：

1. **专业视角**：从专业角度看，这个话题涉及到许多技术细节和专业知识
2. **实践经验**：根据我的经验，实际应用中常常会遇到理论与实践的差距
3. **未来趋势**：我认为未来发展将朝向更加整合和系统化的方向

我很欣赏您作为${roleNames[role1]}提出的那些观点，特别是关于保持开放心态的建议。不过，您是否考虑过这个问题的实际操作层面？`
                },
                {
                    role1: `您提出的实际操作层面确实是一个很好的切入点。作为${roleNames[role1]}，我认为实践中需要注意以下几点：

- **灵活应对**：不同情境可能需要不同的解决方案
- **持续学习**：随着新信息的出现，我们的理解也应该不断更新
- **协作精神**：集思广益往往能产生更好的结果

关于您提到的未来趋势，我很好奇您能否分享一些具体的预测或者案例？这将帮助我更好地理解您的观点。`,
                    
                    role2: `非常高兴您对未来趋势感兴趣。作为${roleNames[role2]}，我可以分享一些具体的预测：

> "根据最新研究，未来五年内，我们可能会看到这个领域的三大转变..."

具体来说：
1. **技术融合**：不同技术领域的边界将变得更加模糊
2. **个性化解决方案**：标准化方案将让位于更加定制化的解决方案
3. **伦理考量**：随着技术发展，伦理问题将成为核心关注点

您作为${roleNames[role1]}提到的协作精神确实至关重要。您认为在促进不同背景人士的协作方面，有哪些有效的策略？`
                },
                {
                    role1: `关于促进不同背景人士协作的策略，作为${roleNames[role1]}，我有以下几点建议：

1. **创建共同语言**：确保所有参与者对关键概念有共同理解
2. **设定明确目标**：清晰的目标有助于团队保持一致方向
3. **重视多元视角**：将不同观点视为资源而非障碍
4. **建立信任机制**：信任是有效协作的基础

我对您提到的伦理考量特别感兴趣。在${topic}这个领域，您认为最紧迫的伦理挑战是什么？我们应该如何平衡创新与伦理责任？`,
                    
                    role2: `您提出了一个非常深刻的问题。作为${roleNames[role2]}，我认为在${topic}领域，最紧迫的伦理挑战包括：

**隐私与透明度**：如何在收集必要数据的同时保护个人隐私
**公平与包容**：确保技术发展不会加剧现有的社会不平等
**责任归属**：在复杂系统中明确责任边界

平衡创新与伦理责任需要：
- 前瞻性伦理评估
- 多方利益相关者参与决策
- 建立适应性监管框架
- 持续的社会对话

您作为${roleNames[role1]}提出的协作策略非常实用。特别是"将不同观点视为资源而非障碍"这一点，体现了真正的智慧。这次对话让我获益良多，感谢您的深入交流！`
                }
            ];
            
            // 创建轮次容器
            for (let i = 0; i < rounds; i++) {
                if (i >= conversations.length) break; // 防止超出模拟数据范围
                
                const roundContainer = document.createElement('div');
                roundContainer.className = 'mb-6 animate__animated animate__fadeIn';
                roundContainer.style.animationDelay = `${i*0.3}s`;
                roundContainer.innerHTML = `<h3 class="text-lg font-semibold mb-3">第 ${i+1} 轮对话</h3>`;
                container.appendChild(roundContainer);
                
                // 第一个角色发言
                const role1Element = document.createElement('div');
                role1Element.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
                role1Element.style.animationDelay = `${i*0.3 + 0.1}s`;
                
                const role1ContentElement = document.createElement('div');
                role1ContentElement.className = 'text-gray-700 markdown-content';
                
                role1Element.innerHTML = `
                    <h4 class="text-lg font-semibold mb-2 ${roleColors[role1]}">AI角色1 (${roleNames[role1]})</h4>
                `;
                
                role1Element.appendChild(role1ContentElement);
                roundContainer.appendChild(role1Element);
                
                // 第二个角色发言
                const role2Element = document.createElement('div');
                role2Element.className = 'card p-6 mb-4 animate__animated animate__fadeIn';
                role2Element.style.animationDelay = `${i*0.3 + 0.2}s`;
                
                const role2ContentElement = document.createElement('div');
                role2ContentElement.className = 'text-gray-700 markdown-content';
                
                role2Element.innerHTML = `
                    <h4 class="text-lg font-semibold mb-2 ${roleColors[role2]}">AI角色2 (${roleNames[role2]})</h4>
                `;
                
                role2Element.appendChild(role2ContentElement);
                roundContainer.appendChild(role2Element);
                
                // 使用打字机效果显示内容
                if (streamMode) {
                    // 模拟流式输出
                    typeWriter(role1ContentElement, conversations[i].role1);
                    setTimeout(() => {
                        typeWriter(role2ContentElement, conversations[i].role2);
                    }, 3000); // 延迟显示第二个角色的回复
                } else {
                    // 直接显示全部内容
                    role1ContentElement.innerHTML = marked.parse(conversations[i].role1);
                    role2ContentElement.innerHTML = marked.parse(conversations[i].role2);
                    
                    // 应用代码高亮
                    role1ContentElement.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                    role2ContentElement.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }
            }
            
            return new Promise(resolve => setTimeout(resolve, 1000));
        }
    </script>
</body>
</html> 